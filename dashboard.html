<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="dashboard.css">
</head>
<body>
    <navbar class="navbar">
        <ul class="nav-list">
            <p class="logo">
                Task Manager
            </p>
        </ul>
        <ul class="nav-list">
            <li><a href="/" aria-current="page">Projects</a></li>
            <li><a href="/">Product Guide</a></li>
            <li><a href="/">About</a></li>
        </ul>
        <ul class="nav-list" onclick="confirmLogout()">
            <p class="cursor">Loading...</p> 
        </ul>
    </navbar>
    <div class="main">
        <div class="sidebar">
          
            <div class="dropdown">
              <div class="dropdown-toggle">Projects ▼</div>
              <div class="dropdown-menu">
                <a href="#">All Projects</a>
                <a href="#">Create New</a>
              </div>
            </div>
          
          <div class="menu-item">Team</div>
        </div>
        <div class="right">

        </div>
    </div>
    <div class="footer">
        <div class="footer1">
            <p style="font-family: cursive; font-size: 60px; color: white; margin-left: 50px;">Task Manager</p>
            <p style="font-family: cursive;color: white; margin-left: 50px;">Task Manager is a project management and issue tracking website that helps teams plan, track, and manage work.  Limited is a leading home service company in Bangladesh which is working for democratizing digital lifestyle across the country.</p>
        </div>
        <div class="footer2">
            <p><a href="/">Projects</a></p>
            <p><a href="/">Product Guide</a></p>
            <p><a href="/">About</a></p>
        </div>
        <div class="footer3">
            <p>

                 House #08, Road #10, Stadium Road, 


            </p>
            <p>
                Mirpur, Dhaka, Bangladesh
            </p>
            <p>
                +88 01328911249
            </p>
            <p>
                task_manager1@gmail.com
            </p>
        </div>
    </div>
    <script>
        const dropdown = document.querySelector('.dropdown');
        const toggle = dropdown.querySelector('.dropdown-toggle');
        let email='';
    
        toggle.addEventListener('click', () => {
          dropdown.classList.toggle('open');
        });
        function confirmLogout() {
            const confirmed = confirm("Do you want to log out?");
            if (confirmed) {
            window.location.href = "#";
            }
        }

        function loadUserName() {
            const urlParams = new URLSearchParams(window.location.search);
            email = urlParams.get('email');

            if (!email) {
                console.error('No email found.');
                return;
            }

            // Fetch and display user name
            fetch('backend/get_user_by_email.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: email })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                document.querySelector('.nav-list .cursor').textContent = data.name;
                loadProjects(email); // ✅ Now fetch projects after name loads
                } else {
                console.error('Failed to load user name:', data.message);
                }
            })
            .catch(error => console.error('Error fetching user name:', error));
        }

        function loadProjects(email) {
            fetch('backend/get_projects_by_email.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                const dropdownMenu = document.querySelector('.dropdown-menu');
                dropdownMenu.innerHTML = ''; // Clear existing

                // Inject projects
                data.projects.forEach(project => {
                    const a = document.createElement('a');
                    a.href = `project.html?id=${project.id}`;
                    a.textContent = project.name;
                    dropdownMenu.appendChild(a);
                });

                // Optionally add "Create New"
                const createNew = document.createElement('a');
                createNew.href = 'create_project.html';
                createNew.textContent = 'Create New';
                dropdownMenu.appendChild(createNew);

                } else {
                console.error('No projects:', data.message);
                }
            })
            .catch(error => console.error('Error fetching projects:', error));
        }


    </script>
</body>
</html>